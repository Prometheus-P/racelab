# ëª¨ë‹ˆí„°ë§ ê°€ì´ë“œ

> KRace í”„ë¡œì íŠ¸ì˜ ëª¨ë‹ˆí„°ë§ ì „ëµ, ë©”íŠ¸ë¦­, ì•Œë¦¼ ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.

## ëª©ì°¨

1. [ëª¨ë‹ˆí„°ë§ ê°œìš”](#ëª¨ë‹ˆí„°ë§-ê°œìš”)
2. [í•µì‹¬ ë©”íŠ¸ë¦­](#í•µì‹¬-ë©”íŠ¸ë¦­)
3. [ë¡œê¹… ì „ëµ](#ë¡œê¹…-ì „ëµ)
4. [ì•Œë¦¼ ì„¤ì •](#ì•Œë¦¼-ì„¤ì •)
5. [ëŒ€ì‹œë³´ë“œ](#ëŒ€ì‹œë³´ë“œ)
6. [ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§](#ì„±ëŠ¥-ëª¨ë‹ˆí„°ë§)
7. [ì™¸ë¶€ API ëª¨ë‹ˆí„°ë§](#ì™¸ë¶€-api-ëª¨ë‹ˆí„°ë§)

---

## ëª¨ë‹ˆí„°ë§ ê°œìš”

### ëª¨ë‹ˆí„°ë§ ìŠ¤íƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      KRace Application                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Vercel Analytics  â”‚  Vercel Logs  â”‚  Custom Metrics        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Vercel Platform                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                    â–¼                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  Sentry  â”‚        â”‚ Datadog  â”‚        â”‚  Slack   â”‚
   â”‚ (Errors) â”‚        â”‚(Metrics) â”‚        â”‚ (Alerts) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ëª¨ë‹ˆí„°ë§ ë ˆë²¨

| ë ˆë²¨ | ëŒ€ìƒ | ë„êµ¬ |
|------|------|------|
| Application | ì—ëŸ¬, ì„±ëŠ¥, ì‚¬ìš©ì ê²½í—˜ | Sentry, Vercel Analytics |
| Infrastructure | ì„œë²„ ë¦¬ì†ŒìŠ¤, ë„¤íŠ¸ì›Œí¬ | Vercel Monitoring |
| Business | KPI, ì‚¬ìš©ì í–‰ë™ | Custom Metrics, Analytics |
| External | KSPO/KRA API ìƒíƒœ | Custom Health Checks |

---

## í•µì‹¬ ë©”íŠ¸ë¦­

### 1. ê°€ìš©ì„± ë©”íŠ¸ë¦­ (Availability)

```typescript
// í•µì‹¬ SLI (Service Level Indicators)
interface AvailabilityMetrics {
  // ì—…íƒ€ì„: ëª©í‘œ 99.9%
  uptime: number;

  // ì„±ê³µë¥ : ëª©í‘œ 99.5%
  successRate: number;

  // ì—ëŸ¬ìœ¨: ëª©í‘œ < 0.5%
  errorRate: number;
}
```

**ìˆ˜ì§‘ ë°©ë²•:**

```typescript
// src/lib/monitoring/availability.ts

export async function trackAvailability(
  endpoint: string,
  success: boolean,
  duration: number
) {
  const metric = {
    name: 'api.availability',
    tags: {
      endpoint,
      status: success ? 'success' : 'failure',
    },
    value: success ? 1 : 0,
    timestamp: Date.now(),
  };

  await sendMetric(metric);
}

// API ë¼ìš°íŠ¸ì—ì„œ ì‚¬ìš©
export async function GET(request: NextRequest) {
  const start = performance.now();
  let success = true;

  try {
    const data = await fetchData();
    return NextResponse.json({ success: true, data });
  } catch (error) {
    success = false;
    throw error;
  } finally {
    await trackAvailability('/api/races', success, performance.now() - start);
  }
}
```

### 2. ì„±ëŠ¥ ë©”íŠ¸ë¦­ (Latency)

```typescript
interface LatencyMetrics {
  // ì‘ë‹µ ì‹œê°„ ë°±ë¶„ìœ„ìˆ˜
  p50: number;  // ëª©í‘œ: < 200ms
  p95: number;  // ëª©í‘œ: < 500ms
  p99: number;  // ëª©í‘œ: < 1000ms

  // TTFB (Time To First Byte)
  ttfb: number; // ëª©í‘œ: < 100ms
}
```

**Core Web Vitals:**

| ë©”íŠ¸ë¦­ | ì„¤ëª… | ëª©í‘œ |
|--------|------|------|
| LCP (Largest Contentful Paint) | ìµœëŒ€ ì½˜í…ì¸  ë Œë”ë§ | < 2.5s |
| FID (First Input Delay) | ì²« ì…ë ¥ ì§€ì—° | < 100ms |
| CLS (Cumulative Layout Shift) | ë ˆì´ì•„ì›ƒ ë³€í™” | < 0.1 |
| INP (Interaction to Next Paint) | ìƒí˜¸ì‘ìš© ì‘ë‹µ | < 200ms |

```typescript
// src/lib/monitoring/web-vitals.ts

import { onCLS, onFID, onLCP, onINP, onTTFB } from 'web-vitals';

export function initWebVitals() {
  onCLS(sendToAnalytics);
  onFID(sendToAnalytics);
  onLCP(sendToAnalytics);
  onINP(sendToAnalytics);
  onTTFB(sendToAnalytics);
}

function sendToAnalytics(metric: Metric) {
  const body = JSON.stringify({
    name: metric.name,
    value: metric.value,
    rating: metric.rating,
    delta: metric.delta,
    id: metric.id,
    navigationType: metric.navigationType,
  });

  // Beacon API ì‚¬ìš© (í˜ì´ì§€ ì´íƒˆ ì‹œì—ë„ ì „ì†¡ ë³´ì¥)
  if (navigator.sendBeacon) {
    navigator.sendBeacon('/api/analytics/vitals', body);
  } else {
    fetch('/api/analytics/vitals', {
      body,
      method: 'POST',
      keepalive: true,
    });
  }
}
```

### 3. íŠ¸ë˜í”½ ë©”íŠ¸ë¦­ (Traffic)

```typescript
interface TrafficMetrics {
  // ìš”ì²­ëŸ‰
  requestsPerSecond: number;
  requestsPerMinute: number;

  // ë™ì‹œ ì‚¬ìš©ì
  concurrentUsers: number;

  // í˜ì´ì§€ë·°
  pageViews: number;
  uniqueVisitors: number;
}
```

### 4. ì—ëŸ¬ ë©”íŠ¸ë¦­ (Errors)

```typescript
interface ErrorMetrics {
  // HTTP ì—ëŸ¬
  http4xxRate: number;  // í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬ìœ¨
  http5xxRate: number;  // ì„œë²„ ì—ëŸ¬ìœ¨

  // ì• í”Œë¦¬ì¼€ì´ì…˜ ì—ëŸ¬
  unhandledExceptions: number;
  handledErrors: number;

  // ì™¸ë¶€ ì„œë¹„ìŠ¤ ì—ëŸ¬
  externalApiErrors: number;
}
```

### 5. í¬í™”ë„ ë©”íŠ¸ë¦­ (Saturation)

```typescript
interface SaturationMetrics {
  // Vercel í•¨ìˆ˜ ë¦¬ì†ŒìŠ¤
  functionMemoryUsage: number;   // ëª©í‘œ: < 80%
  functionCpuUsage: number;      // ëª©í‘œ: < 70%
  functionConcurrency: number;   // ëª©í‘œ: < ë™ì‹œ ì‹¤í–‰ ì œí•œì˜ 80%

  // ìºì‹œ
  cacheHitRate: number;          // ëª©í‘œ: > 80%
  cacheMissRate: number;
}
```

---

## ë¡œê¹… ì „ëµ

### ë¡œê·¸ ë ˆë²¨

| ë ˆë²¨ | ìš©ë„ | ì˜ˆì‹œ |
|------|------|------|
| `error` | ì‹œìŠ¤í…œ ì˜¤ë¥˜, ì¦‰ì‹œ ëŒ€ì‘ í•„ìš” | API ì‹¤íŒ¨, ì˜ˆì™¸ |
| `warn` | ì ì¬ì  ë¬¸ì œ, ì£¼ì˜ í•„ìš” | ëŠë¦° ì‘ë‹µ, ì¬ì‹œë„ |
| `info` | ì¤‘ìš” ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë²¤íŠ¸ | ì‚¬ìš©ì í–‰ë™, ë°°í¬ |
| `debug` | ê°œë°œ/ë””ë²„ê¹…ìš© | ë³€ìˆ˜ ê°’, íë¦„ ì¶”ì  |

### êµ¬ì¡°í™”ëœ ë¡œê¹…

```typescript
// src/lib/logger/index.ts

interface LogEntry {
  timestamp: string;
  level: 'error' | 'warn' | 'info' | 'debug';
  message: string;
  service: string;
  traceId?: string;
  userId?: string;
  context?: Record<string, unknown>;
  error?: {
    name: string;
    message: string;
    stack?: string;
  };
}

class Logger {
  private service = 'krace';

  private formatEntry(
    level: LogEntry['level'],
    message: string,
    context?: Record<string, unknown>
  ): LogEntry {
    return {
      timestamp: new Date().toISOString(),
      level,
      message,
      service: this.service,
      traceId: this.getTraceId(),
      ...context,
    };
  }

  private getTraceId(): string | undefined {
    // Vercel Edgeì—ì„œ ì œê³µí•˜ëŠ” request ID í™œìš©
    if (typeof globalThis !== 'undefined') {
      return (globalThis as any).__VERCEL_REQUEST_ID__;
    }
    return undefined;
  }

  error(message: string, error?: Error, context?: Record<string, unknown>) {
    const entry = this.formatEntry('error', message, {
      ...context,
      error: error
        ? {
            name: error.name,
            message: error.message,
            stack: error.stack,
          }
        : undefined,
    });

    console.error(JSON.stringify(entry));

    // Sentryë¡œ ì—ëŸ¬ ì „ì†¡
    this.sendToSentry(entry, error);
  }

  warn(message: string, context?: Record<string, unknown>) {
    const entry = this.formatEntry('warn', message, context);
    console.warn(JSON.stringify(entry));
  }

  info(message: string, context?: Record<string, unknown>) {
    const entry = this.formatEntry('info', message, context);
    console.info(JSON.stringify(entry));
  }

  debug(message: string, context?: Record<string, unknown>) {
    if (process.env.NODE_ENV === 'development') {
      const entry = this.formatEntry('debug', message, context);
      console.debug(JSON.stringify(entry));
    }
  }

  private sendToSentry(entry: LogEntry, error?: Error) {
    // Sentry í†µí•©
    if (typeof window !== 'undefined' && (window as any).Sentry && error) {
      (window as any).Sentry.captureException(error, {
        extra: entry.context,
        tags: {
          service: entry.service,
          traceId: entry.traceId,
        },
      });
    }
  }
}

export const logger = new Logger();
```

### ë¡œê·¸ ì˜ˆì‹œ

```typescript
// API ìš”ì²­ ë¡œê¹…
logger.info('API request received', {
  endpoint: '/api/races/today',
  method: 'GET',
  userAgent: request.headers.get('user-agent'),
});

// ì™¸ë¶€ API í˜¸ì¶œ ë¡œê¹…
logger.info('External API call', {
  service: 'KSPO',
  endpoint: '/races',
  duration: 245,
  status: 'success',
});

// ì—ëŸ¬ ë¡œê¹…
logger.error('Failed to fetch races', error, {
  endpoint: '/api/races/today',
  retryCount: 3,
});

// ê²½ê³  ë¡œê¹…
logger.warn('Slow API response', {
  endpoint: '/api/races/today',
  duration: 2500,
  threshold: 1000,
});
```

---

## ì•Œë¦¼ ì„¤ì •

### ì•Œë¦¼ ìš°ì„ ìˆœìœ„

| ìš°ì„ ìˆœìœ„ | ì‘ë‹µ ì‹œê°„ | ì•Œë¦¼ ì±„ë„ | ì˜ˆì‹œ |
|----------|-----------|-----------|------|
| P1 (Critical) | 15ë¶„ ì´ë‚´ | Slack + PagerDuty + ì „í™” | ì„œë¹„ìŠ¤ ë‹¤ìš´, ë°ì´í„° ì†ì‹¤ |
| P2 (High) | 1ì‹œê°„ ì´ë‚´ | Slack + PagerDuty | ê¸°ëŠ¥ ì¥ì• , ë†’ì€ ì—ëŸ¬ìœ¨ |
| P3 (Medium) | 4ì‹œê°„ ì´ë‚´ | Slack | ì„±ëŠ¥ ì €í•˜, ê²½ê³  ì„ê³„ì¹˜ |
| P4 (Low) | 24ì‹œê°„ ì´ë‚´ | Email | ì •ë³´ì„± ì•Œë¦¼, íŠ¸ë Œë“œ |

### ì•Œë¦¼ ê·œì¹™

```yaml
# ì•Œë¦¼ ê·œì¹™ ì˜ˆì‹œ (Datadog í˜•ì‹)

alerts:
  # P1: ì„œë¹„ìŠ¤ ë‹¤ìš´
  - name: "Service Down"
    priority: P1
    condition: |
      avg(last_5m):avg:http.status_code{service:krace} >= 500
      AND count(last_5m):sum:http.requests{service:krace} > 10
    message: |
      ğŸš¨ [P1] KRace ì„œë¹„ìŠ¤ ì¥ì•  ê°ì§€
      - 5xx ì—ëŸ¬ ë°œìƒ
      - ì¦‰ì‹œ í™•ì¸ í•„ìš”
    notify:
      - slack-critical
      - pagerduty

  # P1: ì™¸ë¶€ API ì „ë©´ ì¥ì• 
  - name: "External API Total Failure"
    priority: P1
    condition: |
      avg(last_5m):avg:external.api.success_rate{service:kspo} < 10
    message: |
      ğŸš¨ [P1] KSPO API ì „ë©´ ì¥ì• 
      - ì„±ê³µë¥ : {{value}}%
      - í´ë°± ë°ì´í„° ì‚¬ìš© ì¤‘
    notify:
      - slack-critical
      - pagerduty

  # P2: ë†’ì€ ì—ëŸ¬ìœ¨
  - name: "High Error Rate"
    priority: P2
    condition: |
      avg(last_10m):avg:http.error_rate{service:krace} > 5
    message: |
      âš ï¸ [P2] ì—ëŸ¬ìœ¨ ì¦ê°€ ê°ì§€
      - í˜„ì¬ ì—ëŸ¬ìœ¨: {{value}}%
      - ì„ê³„ì¹˜: 5%
    notify:
      - slack-alerts

  # P2: ì‘ë‹µ ì‹œê°„ ê¸‰ì¦
  - name: "High Latency"
    priority: P2
    condition: |
      avg(last_10m):avg:http.response_time.p95{service:krace} > 2000
    message: |
      âš ï¸ [P2] ì‘ë‹µ ì‹œê°„ ì¦ê°€
      - P95 ì‘ë‹µ ì‹œê°„: {{value}}ms
      - ì„ê³„ì¹˜: 2000ms
    notify:
      - slack-alerts

  # P3: ìºì‹œ íˆíŠ¸ìœ¨ ì €í•˜
  - name: "Low Cache Hit Rate"
    priority: P3
    condition: |
      avg(last_30m):avg:cache.hit_rate{service:krace} < 70
    message: |
      ğŸ“Š [P3] ìºì‹œ íš¨ìœ¨ ì €í•˜
      - í˜„ì¬ íˆíŠ¸ìœ¨: {{value}}%
      - ëª©í‘œ: 80%+
    notify:
      - slack-monitoring

  # P3: Core Web Vitals ì €í•˜
  - name: "Poor Core Web Vitals"
    priority: P3
    condition: |
      avg(last_1h):avg:web_vitals.lcp{service:krace} > 2500
    message: |
      ğŸ“Š [P3] LCP ì„±ëŠ¥ ì €í•˜
      - í˜„ì¬ LCP: {{value}}ms
      - ëª©í‘œ: < 2500ms
    notify:
      - slack-monitoring
```

### Slack ì•Œë¦¼ í¬ë§·

```typescript
// src/lib/monitoring/slack-alert.ts

interface SlackAlert {
  priority: 'P1' | 'P2' | 'P3' | 'P4';
  title: string;
  description: string;
  metrics?: Record<string, string | number>;
  actions?: Array<{
    text: string;
    url: string;
  }>;
}

export async function sendSlackAlert(alert: SlackAlert) {
  const color = {
    P1: '#FF0000', // Red
    P2: '#FFA500', // Orange
    P3: '#FFFF00', // Yellow
    P4: '#00FF00', // Green
  }[alert.priority];

  const payload = {
    attachments: [
      {
        color,
        blocks: [
          {
            type: 'header',
            text: {
              type: 'plain_text',
              text: `[${alert.priority}] ${alert.title}`,
            },
          },
          {
            type: 'section',
            text: {
              type: 'mrkdwn',
              text: alert.description,
            },
          },
          ...(alert.metrics
            ? [
                {
                  type: 'section',
                  fields: Object.entries(alert.metrics).map(([key, value]) => ({
                    type: 'mrkdwn',
                    text: `*${key}:*\n${value}`,
                  })),
                },
              ]
            : []),
          ...(alert.actions
            ? [
                {
                  type: 'actions',
                  elements: alert.actions.map((action) => ({
                    type: 'button',
                    text: {
                      type: 'plain_text',
                      text: action.text,
                    },
                    url: action.url,
                  })),
                },
              ]
            : []),
          {
            type: 'context',
            elements: [
              {
                type: 'mrkdwn',
                text: `Triggered at ${new Date().toISOString()}`,
              },
            ],
          },
        ],
      },
    ],
  };

  await fetch(process.env.SLACK_WEBHOOK_URL!, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload),
  });
}
```

---

## ëŒ€ì‹œë³´ë“œ

### ìš´ì˜ ëŒ€ì‹œë³´ë“œ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    KRace Operations Dashboard                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ìƒíƒœ ìš”ì•½]                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Uptime   â”‚ â”‚ Error %  â”‚ â”‚ P95 Lat  â”‚ â”‚ Requests â”‚           â”‚
â”‚  â”‚  99.9%   â”‚ â”‚   0.3%   â”‚ â”‚  245ms   â”‚ â”‚  1.2K/m  â”‚           â”‚
â”‚  â”‚    ğŸŸ¢    â”‚ â”‚    ğŸŸ¢    â”‚ â”‚    ğŸŸ¢    â”‚ â”‚    ğŸŸ¢    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [íŠ¸ë˜í”½]                         [ì—ëŸ¬ìœ¨]                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚     â–ƒâ–…â–†â–‡â–ˆâ–‡â–†â–…â–ƒâ–‚â–        â”‚     â”‚     â–â–â–‚â–â–â–â–‚â–ƒâ–‚â–â–        â”‚   â”‚
â”‚  â”‚  Requests over time     â”‚     â”‚  Errors over time       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ì‘ë‹µ ì‹œê°„ ë¶„í¬]                 [ì™¸ë¶€ API ìƒíƒœ]                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  P50: 120ms            â”‚     â”‚  KSPO API    ğŸŸ¢ OK      â”‚   â”‚
â”‚  â”‚  P95: 245ms            â”‚     â”‚  KRA API     ğŸŸ¢ OK      â”‚   â”‚
â”‚  â”‚  P99: 890ms            â”‚     â”‚                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Core Web Vitals]                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  LCP: 1.8s ğŸŸ¢  â”‚  FID: 45ms ğŸŸ¢  â”‚  CLS: 0.05 ğŸŸ¢        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ìœ„ì ¯

1. **ì„œë¹„ìŠ¤ ìƒíƒœ í‘œì‹œê¸°**
   - ì—…íƒ€ì„ í¼ì„¼íŠ¸
   - í˜„ì¬ ì—ëŸ¬ìœ¨
   - ì‘ë‹µ ì‹œê°„ (P95)
   - ìš”ì²­ëŸ‰ (RPM)

2. **ì‹œê³„ì—´ ì°¨íŠ¸**
   - íŠ¸ë˜í”½ ì¶”ì´ (24ì‹œê°„)
   - ì—ëŸ¬ìœ¨ ì¶”ì´
   - ì‘ë‹µ ì‹œê°„ ë¶„í¬

3. **ì™¸ë¶€ ì˜ì¡´ì„± ìƒíƒœ**
   - KSPO API ìƒíƒœ
   - KRA API ìƒíƒœ
   - CDN ìƒíƒœ

4. **Core Web Vitals**
   - LCP, FID, CLS í˜„í™©
   - íŠ¸ë Œë“œ ë¹„êµ

---

## ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

### API ì„±ëŠ¥ ì¶”ì 

```typescript
// src/lib/monitoring/performance.ts

interface PerformanceMetric {
  endpoint: string;
  method: string;
  duration: number;
  statusCode: number;
  cacheHit: boolean;
}

export function trackApiPerformance(metric: PerformanceMetric) {
  // Vercel Analyticsë¡œ ì „ì†¡
  if (typeof window !== 'undefined' && (window as any).va) {
    (window as any).va('event', {
      name: 'api_performance',
      ...metric,
    });
  }

  // ì„œë²„ ì‚¬ì´ë“œ ë¡œê¹…
  if (typeof window === 'undefined') {
    console.log(
      JSON.stringify({
        type: 'performance',
        ...metric,
        timestamp: Date.now(),
      })
    );
  }
}

// ë¯¸ë“¤ì›¨ì–´ì—ì„œ ì‚¬ìš©
export function withPerformanceTracking(handler: NextHandler) {
  return async (request: NextRequest) => {
    const start = performance.now();

    const response = await handler(request);

    trackApiPerformance({
      endpoint: request.nextUrl.pathname,
      method: request.method,
      duration: performance.now() - start,
      statusCode: response.status,
      cacheHit: response.headers.get('x-vercel-cache') === 'HIT',
    });

    return response;
  };
}
```

### ëŠë¦° ì¿¼ë¦¬ ê°ì§€

```typescript
// src/lib/monitoring/slow-query.ts

const SLOW_THRESHOLD = 1000; // 1ì´ˆ

export function detectSlowOperation(
  operation: string,
  duration: number,
  context?: Record<string, unknown>
) {
  if (duration > SLOW_THRESHOLD) {
    logger.warn('Slow operation detected', {
      operation,
      duration,
      threshold: SLOW_THRESHOLD,
      ...context,
    });

    // ì•Œë¦¼ ì „ì†¡ (ì„ê³„ì¹˜ ì´ˆê³¼ ì‹œ)
    if (duration > SLOW_THRESHOLD * 3) {
      sendSlackAlert({
        priority: 'P3',
        title: 'Slow Operation Detected',
        description: `Operation \`${operation}\` took ${duration}ms`,
        metrics: {
          Duration: `${duration}ms`,
          Threshold: `${SLOW_THRESHOLD}ms`,
        },
      });
    }
  }
}
```

---

## ì™¸ë¶€ API ëª¨ë‹ˆí„°ë§

### í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸

```typescript
// app/api/health/route.ts

import { NextResponse } from 'next/server';

interface HealthStatus {
  status: 'healthy' | 'degraded' | 'unhealthy';
  timestamp: string;
  version: string;
  checks: {
    name: string;
    status: 'pass' | 'warn' | 'fail';
    responseTime?: number;
    message?: string;
  }[];
}

export async function GET() {
  const checks = await Promise.all([
    checkKspoApi(),
    checkKraApi(),
    checkCache(),
  ]);

  const hasFailure = checks.some((c) => c.status === 'fail');
  const hasWarning = checks.some((c) => c.status === 'warn');

  const health: HealthStatus = {
    status: hasFailure ? 'unhealthy' : hasWarning ? 'degraded' : 'healthy',
    timestamp: new Date().toISOString(),
    version: process.env.NEXT_PUBLIC_VERSION || 'unknown',
    checks,
  };

  const statusCode = hasFailure ? 503 : hasWarning ? 200 : 200;

  return NextResponse.json(health, { status: statusCode });
}

async function checkKspoApi() {
  const start = performance.now();
  try {
    const response = await fetch(`${process.env.KSPO_API_URL}/health`, {
      signal: AbortSignal.timeout(5000),
    });
    const responseTime = performance.now() - start;

    return {
      name: 'KSPO API',
      status: response.ok ? (responseTime > 2000 ? 'warn' : 'pass') : 'fail',
      responseTime: Math.round(responseTime),
    };
  } catch (error) {
    return {
      name: 'KSPO API',
      status: 'fail' as const,
      message: error instanceof Error ? error.message : 'Unknown error',
    };
  }
}

async function checkKraApi() {
  // Similar implementation for KRA API
  return { name: 'KRA API', status: 'pass' as const };
}

async function checkCache() {
  // Cache health check
  return { name: 'Cache', status: 'pass' as const };
}
```

### ì™¸ë¶€ API ë©”íŠ¸ë¦­

```typescript
// src/lib/monitoring/external-api.ts

interface ExternalApiMetric {
  service: 'kspo' | 'kra';
  endpoint: string;
  duration: number;
  success: boolean;
  statusCode?: number;
  errorType?: string;
}

const metrics: ExternalApiMetric[] = [];
const WINDOW_SIZE = 100;

export function trackExternalApiCall(metric: ExternalApiMetric) {
  metrics.push(metric);

  // ìœˆë„ìš° í¬ê¸° ìœ ì§€
  if (metrics.length > WINDOW_SIZE) {
    metrics.shift();
  }

  // ë¡œê¹…
  logger.info('External API call', {
    ...metric,
    successRate: calculateSuccessRate(metric.service),
    avgDuration: calculateAvgDuration(metric.service),
  });
}

export function calculateSuccessRate(service: string): number {
  const serviceMetrics = metrics.filter((m) => m.service === service);
  if (serviceMetrics.length === 0) return 100;

  const successCount = serviceMetrics.filter((m) => m.success).length;
  return Math.round((successCount / serviceMetrics.length) * 100);
}

export function calculateAvgDuration(service: string): number {
  const serviceMetrics = metrics.filter((m) => m.service === service);
  if (serviceMetrics.length === 0) return 0;

  const totalDuration = serviceMetrics.reduce((sum, m) => sum + m.duration, 0);
  return Math.round(totalDuration / serviceMetrics.length);
}
```

---

## ì²´í¬ë¦¬ìŠ¤íŠ¸

### ëª¨ë‹ˆí„°ë§ ì„¤ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Vercel Analytics í™œì„±í™”
- [ ] Sentry í”„ë¡œì íŠ¸ ìƒì„± ë° ì—°ë™
- [ ] Slack ì›¹í›… ì„¤ì •
- [ ] ì•Œë¦¼ ê·œì¹™ ì„¤ì •
- [ ] ëŒ€ì‹œë³´ë“œ êµ¬ì„±
- [ ] í—¬ìŠ¤ ì²´í¬ ì—”ë“œí¬ì¸íŠ¸ ë°°í¬
- [ ] Core Web Vitals ì¶”ì  ì„¤ì •

### ì •ê¸° ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ì£¼ê°„: ì—ëŸ¬ íŠ¸ë Œë“œ ê²€í† 
- [ ] ì£¼ê°„: ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê²€í† 
- [ ] ì›”ê°„: SLO ë‹¬ì„±ë¥  ê²€í† 
- [ ] ì›”ê°„: ì•Œë¦¼ ê·œì¹™ ìµœì í™”
- [ ] ë¶„ê¸°: ëª¨ë‹ˆí„°ë§ ì „ëµ ê²€í† 

---

## ì°¸ê³  ìë£Œ

- [Vercel Analytics](https://vercel.com/docs/analytics)
- [Sentry Next.js Integration](https://docs.sentry.io/platforms/javascript/guides/nextjs/)
- [Web Vitals](https://web.dev/vitals/)
- [The Four Golden Signals](https://sre.google/sre-book/monitoring-distributed-systems/)
